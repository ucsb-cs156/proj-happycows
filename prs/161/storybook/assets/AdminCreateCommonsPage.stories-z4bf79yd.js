import{j as e}from"./jsx-runtime-BC85tlZo.js";import{r as l}from"./iframe-BTuJcAs9.js";import{B as de}from"./BasicLayout-BZRsvyjz.js";import{F as n,u as ue}from"./index.esm-CSIWFIrx.js";import{a as W,u as me,y as he}from"./useBackend-CbiZWCPX.js";import{R as S}from"./Row-B6OaNaDg.js";import{C as F}from"./Col-C_aqFeIP.js";import{i as pe,o as fe,l as ye,u as ge,a as z,r as xe,h as K,b as Q,c as be,F as Y,s as A,g as je,d as ve}from"./AbstractModalHeader-Dk09ggGT.js";import{P as Ce}from"./index-BFtBtmCj.js";import{u as we}from"./useWillUnmount-CH5gjzq6.js";import"./warning-0rzsTxeY.js";import{u as Pe,g as Ne,a as X,b as De,m as Fe,c as Re,d as ke}from"./AppNavbar-CeS10Hsd.js";import{u as O,c as L,a as Z}from"./ThemeProvider-BdPtjSDM.js";import{P as Te}from"./index-CRxGUhT0.js";import{u as Ee}from"./Anchor-BzGJqbxn.js";import{B as Se}from"./Button-BDV_ecRq.js";import{N as Oe}from"./index-BB7RSFYR.js";import"./preload-helper-D9Z9MdNV.js";import"./Footer-CkaGO9C0.js";import"./Container-DxFu-v-g.js";import"./currentUser-Beivyx2b.js";import"./index-3Z6SaR-l.js";import"./index-BsV8Hyj2.js";import"./divWithClassName-BgyEq38x.js";import"./CardHeaderContext-COkk7u5z.js";import"./index-UoXrbRkj.js";function $e(){const t=l.useRef(!0),s=l.useRef(()=>t.current);return l.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),s.current}const V=2**31-1;function ee(t,s,r){const o=r-Date.now();t.current=o<=V?setTimeout(s,o):setTimeout(()=>ee(t,s,r),V)}function Be(){const t=$e(),s=l.useRef();return we(()=>clearTimeout(s.current)),l.useMemo(()=>{const r=()=>clearTimeout(s.current);function o(a,i=0){t()&&(r(),i<=V?s.current=setTimeout(a,i):ee(s,a,Date.now()+i))}return{set:o,clear:r,handleRef:s}},[])}const Ue=()=>{};function Le(t,s,{disabled:r,clickTrigger:o}={}){const a=s||Ue;Pe(t,a,{disabled:r,clickTrigger:o});const i=Ee(h=>{pe(h)&&a(h)});l.useEffect(()=>{if(r||t==null)return;const h=fe(Ne(t));let g=(h.defaultView||window).event;const p=ye(h,"keyup",d=>{if(d===g){g=void 0;return}i(d)});return()=>{p()}},[t,r,i])}const te=l.forwardRef((t,s)=>{const{flip:r,offset:o,placement:a,containerPadding:i,popperConfig:h={},transition:g,runTransition:p}=t,[d,c]=X(),[b,v]=X(),x=ge(c,s),f=z(t.container),y=z(t.target),[u,j]=l.useState(!t.show),m=De(y,d,Fe({placement:a,enableEvents:!!t.show,containerPadding:i||5,flip:r,offset:o,arrowElement:b,popperConfig:h}));t.show&&u&&j(!1);const P=(...I)=>{j(!0),t.onExited&&t.onExited(...I)},C=t.show||!u;if(Le(d,t.onHide,{disabled:!t.rootClose||t.rootCloseDisabled,clickTrigger:t.rootCloseEvent}),!C)return null;const{onExit:k,onExiting:N,onEnter:w,onEntering:$,onEntered:B}=t;let U=t.children(Object.assign({},m.attributes.popper,{style:m.styles.popper,ref:x}),{popper:m,placement:a,show:!!t.show,arrowProps:Object.assign({},m.attributes.arrow,{style:m.styles.arrow,ref:v})});return U=xe(g,p,{in:!!t.show,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:U,onExit:k,onExiting:N,onExited:P,onEnter:w,onEntering:$,onEntered:B}),f?Te.createPortal(U,f):null});te.displayName="Overlay";const ae=l.forwardRef(({className:t,bsPrefix:s,as:r="div",...o},a)=>(s=O(s,"popover-header"),e.jsx(r,{ref:a,className:L(t,s),...o})));ae.displayName="PopoverHeader";const G=l.forwardRef(({className:t,bsPrefix:s,as:r="div",...o},a)=>(s=O(s,"popover-body"),e.jsx(r,{ref:a,className:L(t,s),...o})));G.displayName="PopoverBody";function se(t,s){let r=t;return t==="left"?r=s?"end":"start":t==="right"&&(r=s?"start":"end"),r}function re(t="absolute"){return{position:t,top:"0",left:"0",opacity:"0",pointerEvents:"none"}}const ne=l.forwardRef(({bsPrefix:t,placement:s="right",className:r,style:o,children:a,body:i,arrowProps:h,hasDoneInitialMeasure:g,popper:p,show:d,...c},b)=>{const v=O(t,"popover"),x=Z(),[f]=s?.split("-")||[],y=se(f,x);let u=o;return d&&!g&&(u={...o,...re(p?.strategy)}),e.jsxs("div",{ref:b,role:"tooltip",style:u,"x-placement":f,className:L(r,v,f&&`bs-popover-${y}`),...c,children:[e.jsx("div",{className:"popover-arrow",...h}),i?e.jsx(G,{children:a}):a]})});ne.displayName="Popover";const _e=Object.assign(ne,{Header:ae,Body:G,POPPER_OFFSET:[0,8]}),ie=l.forwardRef(({bsPrefix:t,placement:s="right",className:r,style:o,children:a,arrowProps:i,hasDoneInitialMeasure:h,popper:g,show:p,...d},c)=>{t=O(t,"tooltip");const b=Z(),[v]=s?.split("-")||[],x=se(v,b);let f=o;return p&&!h&&(f={...o,...re(g?.strategy)}),e.jsxs("div",{ref:c,style:f,role:"tooltip","x-placement":v,className:L(r,t,`bs-tooltip-${x}`),...d,children:[e.jsx("div",{className:"tooltip-arrow",...i}),e.jsx("div",{className:`${t}-inner`,children:a})]})});ie.displayName="Tooltip";const R=Object.assign(ie,{TOOLTIP_OFFSET:[0,6]});function Ie(t){const s=l.useRef(null),r=O(void 0,"popover"),o=O(void 0,"tooltip"),a=l.useMemo(()=>({name:"offset",options:{offset:()=>{if(t)return t;if(s.current){if(K(s.current,r))return _e.POPPER_OFFSET;if(K(s.current,o))return R.TOOLTIP_OFFSET}return[0,0]}}}),[t,r,o]);return[s,[a]]}function Me(t,s){const{ref:r}=t,{ref:o}=s;t.ref=r.__wrapped||(r.__wrapped=a=>r(A(a))),s.ref=o.__wrapped||(o.__wrapped=a=>o(A(a)))}const oe=l.forwardRef(({children:t,transition:s=Y,popperConfig:r={},rootClose:o=!1,placement:a="top",show:i=!1,...h},g)=>{const p=l.useRef({}),[d,c]=l.useState(null),[b,v]=Ie(h.offset),x=Q(g,b),f=s===!0?Y:s||void 0,y=be(u=>{c(u),r==null||r.onFirstUpdate==null||r.onFirstUpdate(u)});return Re(()=>{d&&h.target&&(p.current.scheduleUpdate==null||p.current.scheduleUpdate())},[d,h.target]),l.useEffect(()=>{i||c(null)},[i]),e.jsx(te,{...h,ref:x,popperConfig:{...r,modifiers:v.concat(r.modifiers||[]),onFirstUpdate:y},transition:f,rootClose:o,placement:a,show:i,children:(u,{arrowProps:j,popper:m,show:P})=>{var C;Me(u,j);const k=m?.placement,N=Object.assign(p.current,{state:m?.state,scheduleUpdate:m?.update,placement:k,outOfBoundaries:(m==null||(C=m.state)==null||(C=C.modifiersData.hide)==null?void 0:C.isReferenceHidden)||!1,strategy:r.strategy}),w=!!d;return typeof t=="function"?t({...u,placement:k,show:P,...!s&&P&&{className:"show"},popper:N,arrowProps:j,hasDoneInitialMeasure:w}):l.cloneElement(t,{...u,placement:k,arrowProps:j,popper:N,hasDoneInitialMeasure:w,className:L(t.props.className,!s&&P&&"show"),style:{...t.props.style,...u.style}})}})});oe.displayName="Overlay";function Ae(t){return t&&typeof t=="object"?t:{show:t,hide:t}}function J(t,s,r){const[o]=s,a=o.currentTarget,i=o.relatedTarget||o.nativeEvent[r];(!i||i!==a)&&!ve(a,i)&&t(...s)}Ce.oneOf(["click","hover","focus"]);const T=({trigger:t=["hover","focus"],overlay:s,children:r,popperConfig:o={},show:a,defaultShow:i=!1,onToggle:h,delay:g,placement:p,flip:d=p&&p.indexOf("auto")!==-1,...c})=>{const b=l.useRef(null),v=Q(b,je(r)),x=Be(),f=l.useRef(""),[y,u]=ke(a,i,h),j=Ae(g),{onFocus:m,onBlur:P,onClick:C}=typeof r!="function"?l.Children.only(r).props:{},k=D=>{v(A(D))},N=l.useCallback(()=>{if(x.clear(),f.current="show",!j.show){u(!0);return}x.set(()=>{f.current==="show"&&u(!0)},j.show)},[j.show,u,x]),w=l.useCallback(()=>{if(x.clear(),f.current="hide",!j.hide){u(!1);return}x.set(()=>{f.current==="hide"&&u(!1)},j.hide)},[j.hide,u,x]),$=l.useCallback((...D)=>{N(),m?.(...D)},[N,m]),B=l.useCallback((...D)=>{w(),P?.(...D)},[w,P]),U=l.useCallback((...D)=>{u(!y),C?.(...D)},[C,u,y]),I=l.useCallback((...D)=>{J(N,D,"fromElement")},[N]),ce=l.useCallback((...D)=>{J(w,D,"toElement")},[w]),M=t==null?[]:[].concat(t),E={ref:k};return M.indexOf("click")!==-1&&(E.onClick=U),M.indexOf("focus")!==-1&&(E.onFocus=$,E.onBlur=B),M.indexOf("hover")!==-1&&(E.onMouseOver=I,E.onMouseOut=ce),e.jsxs(e.Fragment,{children:[typeof r=="function"?r(E):l.cloneElement(r,E),e.jsx(oe,{...c,show:y,onHide:w,flip:d,placement:p,popperConfig:o,target:b.current,children:s})]})};function q({formName:t,displayName:s,initialValue:r,healthUpdateStrategies:o,register:a}){return e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:t,children:s}),o&&e.jsx(n.Select,{"data-testid":`${t}-select`,id:t,...a(t),defaultValue:r,children:o.strategies.map(i=>e.jsx("option",{value:i.name,title:i.description,"data-testid":t+"-"+i.name,children:i.displayName},i.name))})]})}q.__docgenInfo={description:"",methods:[],displayName:"HealthUpdateStrategiesDropdown"};function le({initialCommons:t,submitAction:s,buttonLabel:r="Create"}){let o=t?{...t}:{};o.startingDate&&(o.startingDate=o.startingDate.split("T")[0]);const{register:a,formState:{errors:i},handleSubmit:h,reset:g}=ue({defaultValues:o}),{data:p}=W(["/api/commons/all-health-update-strategies"],{method:"GET",url:"/api/commons/all-health-update-strategies"}),{data:d}=W(["/api/commons/defaults"],{method:"GET",url:"/api/commons/defaults"});l.useEffect(()=>{if(d&&!t){const{startingBalance:m,cowPrice:P,milkPrice:C,degradationRate:k,carryingCapacity:N,capacityPerUser:w,aboveCapacityStrategy:$,belowCapacityStrategy:B}=d;g({startingBalance:m,cowPrice:P,milkPrice:C,degradationRate:k,carryingCapacity:N,capacityPerUser:w,aboveCapacityStrategy:$,belowCapacityStrategy:B})}},[d,t,g]);const c="CommonsForm",b=new Date,v=b.toLocaleDateString("en-CA"),x=b.getMonth()%12,f=new Date(b.getFullYear(),x+1,b.getDate()).toISOString().substr(0,10),y={name:"",startingBalance:d?.startingBalance||"10000",cowPrice:d?.cowPrice||"100",milkPrice:d?.milkPrice||"1",degradationRate:d?.degradationRate||.001,carryingCapacity:d?.carryingCapacity||100,startingDate:v,lastDate:f},u=d?.belowCapacityStrategy,j=d?.aboveCapacityStrategy;return e.jsxs(n,{onSubmit:h(s),children:[t&&e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"id",children:"Id"}),e.jsx(n.Control,{"data-testid":`${c}-id`,id:"id",type:"text",...a("id"),value:t.id,disabled:!0})]}),e.jsx("div",{className:"border-bottom mb-3"}),e.jsxs(S,{className:"flex justify-content-start",style:{width:"80%"},"data-testid":`${c}-r0`,children:[e.jsx(F,{className:"",md:6,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"name",children:"Commons Name"}),e.jsx(T,{placement:"top",overlay:e.jsx(R,{children:"This is the name farmers will see when joining the game."}),delay:"5",children:e.jsx(n.Control,{"data-testid":`${c}-name`,id:"name",type:"text",defaultValue:y.name,isInvalid:!!i.name,...a("name",{required:"Commons name is required"})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.name?.message})]})}),e.jsx(F,{md:6,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"startingBalance",children:"Starting Balance"}),e.jsx(T,{placement:"top",overlay:e.jsx(R,{children:"Each farmer starts with this amount of money in dollars."}),delay:"100",children:e.jsx(n.Control,{id:"startingBalance","data-testid":`${c}-startingBalance`,type:"number",step:"0.01",defaultValue:y.startingBalance,isInvalid:!!i.startingBalance,...a("startingBalance",{valueAsNumber:!0,required:"Starting Balance is required",min:{value:0,message:"Starting Balance must be ≥ 0.00"}})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.startingBalance?.message})]})})]}),e.jsxs(S,{className:"flex justify-content-start",style:{width:"80%"},"data-testid":`${c}-r1`,children:[e.jsx(F,{md:6,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"cowPrice",children:"Cow Price"}),e.jsx(T,{placement:"top",overlay:e.jsx(R,{children:"This is the price to purchase cows. The selling price is this amount times the health of the cows on that farm."}),delay:"100",children:e.jsx(n.Control,{"data-testid":`${c}-cowPrice`,id:"cowPrice",type:"number",step:"0.01",defaultValue:y.cowPrice,isInvalid:!!i.cowPrice,...a("cowPrice",{valueAsNumber:!0,required:"Cow price is required",min:{value:.01,message:"Cow price must be ≥ 0.01"}})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.cowPrice?.message})]})}),e.jsx(F,{md:6,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"milkPrice",children:"Milk Price"}),e.jsx(T,{placement:"top",overlay:e.jsx(R,{children:"This is the amount of money the farmer earns in profits for each cow every time it is milked if it is at 100% health. When a cow is at health less than 100%, the amount earned is multiplied by that percentage (e.g. 75% of the milk price if the health is at 75%)."}),delay:"100",children:e.jsx(n.Control,{"data-testid":`${c}-milkPrice`,id:"milkPrice",type:"number",step:"0.01",defaultValue:y.milkPrice,isInvalid:!!i.milkPrice,...a("milkPrice",{valueAsNumber:!0,required:"Milk price is required",min:{value:.01,message:"Milk price must be ≥ 0.01"}})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.milkPrice?.message})]})})]}),e.jsxs(S,{className:"mt-1 flex justify-content-start",style:{width:"80%"},"data-testid":`${c}-r2`,children:[e.jsx(F,{md:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"degradationRate",children:"Degradation Rate"}),e.jsx(T,{placement:"bottom",overlay:e.jsx(R,{children:"This number controls the rate at which cow health decreases when the number of cows in the commons is greater than the effective carrying capacity. The way in which the number is used depends on the selected Health Update Formulas below."}),delay:"100",children:e.jsx(n.Control,{"data-testid":`${c}-degradationRate`,id:"degradationRate",type:"number",step:"0.0001",defaultValue:y.degradationRate,isInvalid:!!i.degradationRate,...a("degradationRate",{valueAsNumber:!0,required:"Degradation rate is required",min:{value:0,message:"Degradation rate must be ≥ 0"}})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.degradationRate?.message})]})}),e.jsx(F,{md:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"carryingCapacity",children:"Carrying Capacity"}),e.jsx(T,{placement:"bottom",overlay:e.jsx(R,{children:"This is the minimum carrying capacity for the commons; at least this many cows may graze in the commons regardless of the number of players. If this number is zero, then only the Capacity Per User is used to determine the actual carrying capacity."}),delay:"100",children:e.jsx(n.Control,{"data-testid":`${c}-carryingCapacity`,id:"carryingCapacity",type:"number",step:"1",defaultValue:y.carryingCapacity,isInvalid:!!i.carryingCapacity,...a("carryingCapacity",{valueAsNumber:!0,required:"Carrying capacity is required",min:{value:1,message:"Carrying Capacity must be ≥ 1"}})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.carryingCapacity?.message})]})}),e.jsx(F,{md:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"capacityPerUser",children:"Capacity Per User"}),e.jsx(T,{placement:"bottom",overlay:e.jsx(R,{children:"When this number is greater than zero, the commons will be able to support at least this many cows per farmer; that is, the effective carrying capacity of the commons is the value of Carrying Capacity, or Capacity Per User times the number of Farmers, whichever is greater. If this number is zero, then the Carrying Capacity is fixed regardless of the number of users."}),delay:"100",children:e.jsx(n.Control,{"data-testid":`${c}-capacityPerUser`,id:"capacityPerUser",type:"number",step:"1",defaultValue:d?.capacityPerUser,isInvalid:!!i.capacityPerUser,...a("capacityPerUser",{valueAsNumber:!0,required:"Capacity Per User is required"})})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.capacityPerUser?.message})]})})]}),e.jsxs(S,{children:[e.jsxs(n.Group,{className:"mb-5",style:{width:"300px",height:"50px"},"data-testid":`${c}-r3`,children:[e.jsx(n.Label,{htmlFor:"startingDate",children:"Starting Date"}),e.jsx(n.Control,{"data-testid":`${c}-startingDate`,id:"startingDate",type:"date",defaultValue:y.startingDate,isInvalid:!!i.startingDate,...a("startingDate",{valueAsDate:!0,validate:{isPresent:m=>!isNaN(m)}})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.startingDate?.message})]}),e.jsxs(n.Group,{className:"mb-5",style:{width:"300px",height:"50px"},"data-testid":`${c}-r4`,children:[e.jsx(n.Label,{htmlFor:"lastDate",children:"Last Date"}),e.jsx(n.Control,{"data-testid":`${c}-lastDate`,id:"lastDate",type:"date",defaultValue:y.lastDate,isInvalid:!!i.lastDate,...a("lastDate",{valueAsDate:!0,validate:{isPresent:m=>!isNaN(m)}})}),e.jsx(n.Control.Feedback,{type:"invalid",children:i.lastDate?.message})]})]}),e.jsx("h5",{children:"Health update formula"}),e.jsx("div",{className:"border-bottom mb-4"}),e.jsxs(S,{children:[e.jsx(F,{md:6,children:e.jsx(q,{formName:"aboveCapacityHealthUpdateStrategy",displayName:"When above capacity",initialValue:j,register:a,healthUpdateStrategies:p})}),e.jsx(F,{md:6,children:e.jsx(q,{formName:"belowCapacityHealthUpdateStrategy",displayName:"When below capacity",initialValue:u,register:a,healthUpdateStrategies:p})})]}),e.jsxs(S,{children:[e.jsx(F,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"showLeaderboard",children:"Show Leaderboard?"}),e.jsx(T,{placement:"bottom",overlay:e.jsx(R,{children:"When checked, regular users will have access to the leaderboard for this commons. When unchecked, only admins can see the leaderboard for this commons."}),delay:"100",children:e.jsx(n.Check,{"data-testid":`${c}-showLeaderboard`,type:"checkbox",id:"showLeaderboard",...a("showLeaderboard")})})]})}),e.jsx(F,{children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{htmlFor:"showChat",children:"Show Chat?"}),e.jsx(T,{placement:"bottom",overlay:e.jsx(R,{children:"When checked, regular users will have access to the chat for this commons. When unchecked, only admins can see the chat for this commons."}),delay:"100",children:e.jsx(n.Check,{"data-testid":`${c}-showChat`,type:"checkbox",id:"showChat",...a("showChat")})})]})})]}),e.jsx(S,{className:"mb-5",children:e.jsx(Se,{type:"submit","data-testid":"CommonsForm-Submit-Button",className:"pl-1 w-30 text-left",style:{width:"30%"},children:r})})]})}le.__docgenInfo={description:"",methods:[],displayName:"CommonsForm",props:{buttonLabel:{defaultValue:{value:'"Create"',computed:!1},required:!1}}};const H=()=>{const r=me(a=>({url:"/api/commons/new",method:"POST",data:a}),{onSuccess:a=>{he(e.jsxs("div",{children:["Commons successfully created!",e.jsx("br",{}),`id: ${a.id}`,e.jsx("br",{}),`name: ${a.name}`,e.jsx("br",{}),`startDate: ${a.startingDate}`,e.jsx("br",{}),`lastDate: ${a.lastDate}`,e.jsx("br",{}),`cowPrice: ${a.cowPrice}`,e.jsx("br",{}),`capacityPerUser: ${a.capacityPerUser}`,e.jsx("br",{}),`carryingCapacity: ${a.carryingCapacity}`]}))}},["/api/commons/all"]),o=async a=>{r.mutate(a)};return r.isSuccess?e.jsx(Oe,{to:"/"}):e.jsxs(de,{children:[e.jsx("h2",{children:"Create Commons"}),e.jsx(le,{submitAction:o})]})};H.__docgenInfo={description:"",methods:[],displayName:"AdminCreateCommonsPage"};const ft={title:"pages/AdminCreateCommonsPage",component:H},Ve=()=>e.jsx(H,{}),_=Ve.bind({});_.parameters={..._.parameters,docs:{..._.parameters?.docs,source:{originalSource:"() => <AdminCreateCommonsPage />",..._.parameters?.docs?.source}}};const yt=["Default"];export{_ as Default,yt as __namedExportsOrder,ft as default};
