import{j as e}from"./jsx-runtime-BC85tlZo.js";import{r as g,R as H}from"./iframe-BTuJcAs9.js";import{B as ie}from"./BasicLayout-BZRsvyjz.js";import{h as k,u as G}from"./currentUser-Beivyx2b.js";import{u as le,a as I}from"./index-BB7RSFYR.js";import{C as r}from"./Card-CztHanru.js";import{R as A}from"./Row-B6OaNaDg.js";import{C as P}from"./Col-C_aqFeIP.js";import{B as f}from"./Button-BDV_ecRq.js";/* empty css                 */import{u as L,c as M}from"./ThemeProvider-BdPtjSDM.js";import{m as ce,F as w}from"./index.esm-CSIWFIrx.js";import{O as de}from"./OurTable-DtSV993S.js";import{a as C,y as me,u as D}from"./useBackend-CbiZWCPX.js";import{C as ue}from"./ChatPanel-MAkDpdd7.js";import{M as S}from"./Modal-Xy1HWVR7.js";import{C as he}from"./Container-DxFu-v-g.js";import"./preload-helper-D9Z9MdNV.js";import"./Footer-CkaGO9C0.js";import"./AppNavbar-CeS10Hsd.js";import"./index-BsV8Hyj2.js";import"./index-CRxGUhT0.js";import"./index-UoXrbRkj.js";import"./AbstractModalHeader-Dk09ggGT.js";import"./Anchor-BzGJqbxn.js";import"./index-BFtBtmCj.js";import"./divWithClassName-BgyEq38x.js";import"./CardHeaderContext-COkk7u5z.js";import"./warning-0rzsTxeY.js";import"./index-3Z6SaR-l.js";import"./Table-C9FVjeDE.js";import"./ChatMessageCreate-Biqo2bhw.js";import"./ChatDisplay-mZDviX0u.js";import"./ChatMessageDisplay-BzMMJRvD.js";import"./useWillUnmount-CH5gjzq6.js";const Y=g.forwardRef(({className:s,bsPrefix:t,as:o="div",...a},i)=>(t=L(t,"card-group"),e.jsx(o,{ref:i,className:M(s,t),...a})));Y.displayName="CardGroup";const O=1e3;function pe(s,t,o){const a=(s-t)/(o-t)*100;return Math.round(a*O)/O}function R({min:s,now:t,max:o,label:a,visuallyHidden:i,striped:d,animated:c,className:p,style:x,variant:u,bsPrefix:l,...n},m){return e.jsx("div",{ref:m,...n,role:"progressbar",className:M(p,`${l}-bar`,{[`bg-${u}`]:u,[`${l}-bar-animated`]:c,[`${l}-bar-striped`]:c||d}),style:{width:`${pe(t,s,o)}%`,...x},"aria-valuenow":t,"aria-valuemin":s,"aria-valuemax":o,children:i?e.jsx("span",{className:"visually-hidden",children:a}):a})}const U=g.forwardRef(({isChild:s=!1,...t},o)=>{const a={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...t};if(a.bsPrefix=L(a.bsPrefix,"progress"),s)return R(a,o);const{min:i,now:d,max:c,label:p,visuallyHidden:x,striped:u,animated:l,bsPrefix:n,variant:m,className:j,children:y,...v}=a;return e.jsx("div",{ref:o,...v,className:M(j,n),children:y?ce(y,N=>g.cloneElement(N,{isChild:!0})):R({min:i,now:d,max:c,label:p,visuallyHidden:x,striped:u,animated:l,bsPrefix:n,variant:m},o)})});U.displayName="ProgressBar";const E=s=>s<10?"0"+s:s,xe=s=>{var t=new Date(s);return t.getFullYear()+"-"+E(t.getMonth()+1)+"-"+E(t.getDate())},fe=s=>{var t=new Date,o=new Date(s),a=Math.abs(t.getTime()-o.getTime());return Math.ceil(a/(1e3*3600*24))};function W({commonsPlus:s,currentUser:t}){let o=le();const a=()=>{o("/leaderboard/"+s.commons.id)},i=k(t,"ROLE_ADMIN")||s.commons.showLeaderboard;return e.jsxs(r,{"data-testid":"CommonsOverview",children:[e.jsx(r.Header,{as:"h5",className:"woodenboardtable",children:"Announcements"}),e.jsx(r.Body,{style:{backgroundColor:"rgb(245, 210, 140)"},children:e.jsxs(A,{children:[e.jsxs(P,{children:[e.jsxs(r.Title,{children:["Today is day ",fe(s.commons.startingDate),"!"]}),e.jsxs(r.Text,{children:["Total Players: ",s.totalUsers]})]}),e.jsx(P,{children:i&&e.jsx(f,{variant:"outline-success","data-testid":"user-leaderboard-button",onClick:a,children:"Leaderboard"})})]})})]})}W.__docgenInfo={description:"",methods:[],displayName:"CommonsOverview"};const F=["Welcome, farmer","Greetings, seasoned farmer","Hello there, skilled farmer","Good day, dedicated farmer","Ahoy! Welcome farmer","Top of the morning to you farmer","Howdy farmer","A warm welcome to you, farmer extraordinaire","The cows await your care farmer","Your cows beckon for your attention","Your cow  expertise is needed farmer","The fields are alive with possibilities farmer","Your land awaits farmer","Your farmstead awaits farmer","Your journey continues farmer","Welcome to another chapter in your tale, farmer","Greetings, your destiny unfolds, farmer","Hello again, the cows need you farmer"];function z({currentUser:s}){const t=s?.root?s?.root?.user?.givenName:"",[o,a]=g.useState(F[Math.floor(Math.random()*F.length)]);return e.jsx("div",{"data-testid":"CommonsPlay",children:e.jsx(r,{"data-testid":"commons-card",className:"woodentitle",children:e.jsx("div",{className:"text-center border-0 my-3",children:e.jsxs("h1",{"data-testid":"commonsPlay-title",className:"animate-charcter",children:[o," ",t,"!"]})})})})}z.__docgenInfo={description:"",methods:[],displayName:"CommonsPlay"};const J=({userCommons:s})=>e.jsxs(r,{children:[e.jsx(r.Header,{as:"h5",className:"woodenboardtable",children:"Your Farm Stats"}),e.jsxs(r.Body,{style:{backgroundColor:"rgb(245, 210, 140)"},children:[e.jsxs(r.Title,{className:"text-center",children:["ðŸ’° Total Wealth: $",s.totalWealth.toFixed(2)]}),e.jsxs(r.Text,{children:["Total Cows Bought: ",s.cowsBought]}),e.jsxs(r.Text,{children:["Total Cows Sold: ",s.cowsSold]}),e.jsxs(r.Title,{className:"text-center",children:["â¤ï¸ Cow Health: ",Math.round(s.cowHealth*100)/100,"%"]}),e.jsx(U,{now:s.cowHealth,min:0,max:100,variant:"danger"}),e.jsxs(r.Text,{children:["ðŸ’€ Cow Deaths: ",s.cowDeaths]})]})]});J.__docgenInfo={description:"",methods:[],displayName:"FarmStats"};const V=({userCommons:s,commons:t,setMessage:o,openModal:a})=>{const{data:i}=G();let{userId:d}=I();d=d?parseInt(d,10):NaN;const c=k(i,"ROLE_ADMIN")&&!isNaN(d);return e.jsxs(r,{children:[e.jsx(r.Header,{as:"h5",className:"woodenboardtable",children:"Manage Cows"}),e.jsxs(r.Body,{style:{backgroundColor:"rgb(245, 210, 140)"},children:[e.jsxs(r.Title,{className:"text-center",children:["ðŸ’µ Market Cow Price: $",t?.cowPrice]}),e.jsxs(r.Title,{className:"text-center",children:["ðŸ® Number of Cows: ",s.numOfCows]}),e.jsxs(r.Title,{className:"text-center",children:["ðŸ¥› Current Milk Price: $",t?.milkPrice]}),c?e.jsx(e.Fragment,{children:e.jsx("p",{"data-testid":"ManageCows-ViewOnly",children:"This page is for viewing only, cannot buy and sell cows."})}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(P,{className:"text-center",children:e.jsx(f,{variant:"outline-success",onClick:()=>{o("buy"),a()},"data-testid":"buy-cow-button",children:"Buy cows"})}),e.jsx(P,{className:"text-center",children:e.jsx(f,{variant:"outline-danger",onClick:()=>{o("sell"),a()},"data-testid":"sell-cow-button",children:"Sell cows"})})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Note:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Buying cows buys at the current cow price."}),e.jsx("li",{children:"Selling cows sells at the current cow price multiplied by the average cow health (as a percentage.)"})]})]})]})]})]})};V.__docgenInfo={description:"",methods:[],displayName:"ManageCows"};const Z=()=>{const s="PagedProfitsTable",[o,a]=H.useState(0),i=5,{commonsId:d}=I(),{data:c}=C(["/api/profits/paged/commonsid"],{method:"GET",url:"/api/profits/paged/commonsid",params:{commonsId:d,pageNumber:o,pageSize:i}},{content:[],totalPages:0},{refetchInterval:5e3}),p="PagedProfitsTable",x=()=>()=>{a(o-1)},u=()=>()=>{a(o+1)},l=[{Header:"Profit",accessor:"amount",Cell:({value:m})=>`$${m.toFixed(2)}`,width:200},{Header:"Date",accessor:"timestamp",Cell:({value:m})=>xe(m),width:200},{Header:"Health",accessor:"avgCowHealth",Cell:({value:m})=>`${m.toFixed(2)+"%"}`,width:200},{Header:"Cows",accessor:"numCows",width:200}],n=H.useMemo(()=>[{id:"timestamp",desc:!0}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Page: ",o+1]}),e.jsx(f,{"data-testid":`${s}-previous-button`,onClick:x(),disabled:o===0,children:"Previous"}),e.jsx(f,{"data-testid":`${s}-next-button`,onClick:u(),disabled:c.totalPages===0||o===c.totalPages-1,children:"Next"}),e.jsx("div",{"data-testid":"PagedProfitsTable-CSS",style:{display:"flex",overflow:"auto"},children:e.jsx(de,{data:c.content,columns:l,testid:p,initialState:{sortBy:n}})})]})};Z.__docgenInfo={description:"",methods:[],displayName:"PagedProfitsTable"};const q=()=>e.jsxs(r,{children:[e.jsx(r.Header,{as:"h5",className:"woodenboardtable",children:"Profits"}),e.jsxs(r.Body,{style:{backgroundColor:"rgb(245, 210, 140)"},children:[e.jsx(r.Title,{children:"You will earn profits from milking your cows everyday at 4am."}),e.jsx(Z,{})]})]});q.__docgenInfo={description:"",methods:[],displayName:"Profits"};const ge=""+new URL("PlayPageBackground-D9LHwgei.jpg",import.meta.url).href,K=({number:s,setNumber:t,isOpen:o,onClose:a,message:i,userCommons:d,onBuy:c,onSell:p})=>{const x=n=>{n.target.value<0&&me.warn(`Warning: You cannot ${i} a negative number of cows!`),t(n.target.value)},u=n=>{n.preventDefault(),s<0?window.alert(`You cannot ${i} a negative number of cows! Please enter a non-negative number.`):(i.includes("buy")?c(d,s):p(d,s),t(1),a())},l=()=>{t(1),a()};return o?e.jsxs(S,{"data-testid":"buy-sell-cow-modal",show:o,onHide:l,children:[e.jsx(S.Body,{children:e.jsxs(w,{onSubmit:u,children:[e.jsx(w.Group,{"data-testid":"buy-sell-cow-modal-closeGroup",style:{display:"flex",justifyContent:"right"},children:e.jsx(f,{"data-testid":"buy-sell-cow-modal-close",style:{color:"#000",borderColor:"#fff",backgroundColor:"#fff"},type:"button",className:"close","aria-label":"Close",onClick:l,children:e.jsx("span",{"aria-hidden":"true",children:"Ã—"})})}),e.jsx(w.Group,{children:e.jsxs(w.Label,{children:["Please specify the number of cows you'd like to ",i," below."]})}),e.jsx(w.Group,{children:e.jsx(w.Control,{"data-testid":"buy-sell-cow-modal-input",style:{width:"20%"},type:"number",value:s,onChange:x,min:"1"})})]})}),e.jsxs(S.Footer,{"data-testid":"buy-sell-cow-modal-footer",style:{borderTop:"0px"},children:[e.jsx(f,{"data-testid":"buy-sell-cow-modal-cancel",variant:"secondary",onClick:l,children:"Cancel"}),e.jsx(f,{"data-testid":"buy-sell-cow-modal-submit",variant:"primary",onClick:u,children:i[0].toUpperCase()+i.slice(1)})]})]}):null};K.__docgenInfo={description:"",methods:[],displayName:"ManageCowsModal"};function B(){const{commonsId:s}=I(),{data:t}=G(),[o,a]=g.useState(!1),[i,d]=g.useState(),[c,p]=g.useState(1),x=()=>{a(!0)},u=()=>{a(!1)},{data:l}=C([`/api/usercommons/forcurrentuser?commonsId=${s}`],{method:"GET",url:"/api/usercommons/forcurrentuser",params:{commonsId:s}}),{data:n}=C([`/api/commons/plus?id=${s}`],{method:"GET",url:"/api/commons/plus",params:{id:s}}),m=!(typeof n>"u");let j,y;m&&(j=t.root.user.commons,y=j.some(h=>h.id===n.commons.id));const v=m&&y,N=m&&!y,{data:Q}=C([`/api/profits/all/commonsid?commonsId=${s}`],{method:"GET",url:"/api/profits/all/commonsid",params:{commonsId:s}}),X=D(h=>({url:"/api/usercommons/buy",method:"PUT",data:h,params:{commonsId:s,numCows:c}}),null,[`/api/usercommons/forcurrentuser?commonsId=${s}`]),ee=(h,T)=>{X.mutate(h,T)},se=D(h=>({url:"/api/usercommons/sell",method:"PUT",data:h,params:{commonsId:s,numCows:c}}),{onSuccess:()=>{}},[`/api/usercommons/forcurrentuser?commonsId=${s}`]),te=(h,T)=>{se.mutate(h,T)},[_,oe]=g.useState(!1),ae=()=>{oe(h=>!h)},re={width:"60px",height:"60px",borderRadius:"25%",backgroundColor:"lightblue",color:"black",position:"fixed",bottom:"30px",right:"30px"},ne={width:"550px",position:"fixed",bottom:"100px",right:"20px"},$={fontFamily:"Arial, sans-serif",fontSize:"30px"};return e.jsxs("div",{style:{backgroundSize:"cover",backgroundImage:`url(${ge})`},"data-testid":"playpage-div",children:[e.jsx(ie,{children:e.jsxs(he,{children:[!n&&e.jsx("h1",{children:"This commons does not exist!"}),N&&e.jsx("h1",{children:"You have yet to join this commons!"}),v&&!!t&&e.jsx(z,{currentUser:t}),!!n&&e.jsx(W,{commonsPlus:n,currentUser:t}),e.jsx("br",{}),!!l&&!!n&&e.jsxs(Y,{children:[e.jsx(V,{userCommons:l,commons:n.commons,setMessage:d,openModal:x}),e.jsx(J,{userCommons:l}),e.jsx(q,{userCommons:l,profits:Q}),e.jsx(K,{number:c,setNumber:p,userCommons:l,isOpen:o,message:i,onClose:u,onBuy:ee,onSell:te})]})]})}),(k(t,"ROLE_ADMIN")||!!n&&n.commons.showChat)&&e.jsxs("div",{style:ne,"data-testid":"playpage-chat-div",children:[!!_&&e.jsx(ue,{commonsId:s}),e.jsx(f,{style:re,onClick:ae,"data-testid":"playpage-chat-toggle",children:_?e.jsx("span",{style:$,"data-testid":"close-icon",children:"âŒ"}):e.jsx("span",{style:$,"data-testid":"message-icon",children:"ðŸ’¬"})})]})]})}B.__docgenInfo={description:"",methods:[],displayName:"PlayPage"};const os={title:"pages/PlayPage",component:B},ye=()=>e.jsx(B,{}),b=ye.bind({});b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:"() => <PlayPage />",...b.parameters?.docs?.source}}};const as=["Default"];export{b as Default,as as __namedExportsOrder,os as default};
